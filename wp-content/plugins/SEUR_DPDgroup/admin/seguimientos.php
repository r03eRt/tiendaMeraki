<?php
class SEUR_seguimientos { public $sClassName = 'SEUR_admin' ; public $sPageSlug   = 'seur_seguimientos' ; public $sTabSecID    = 'seguimientos' ; public function __construct( $sClassName='', $sPageSlug='', $sTabSecID='' ) { $this->sClassName   = $sClassName ? $sClassName : $this->sClassName ; $this->sPageSlug    = $sPageSlug ? $sPageSlug : $this->sPageSlug ; $this->sTabSecID     = $sTabSecID ? $sTabSecID : $this->sTabSecID ; add_action( 'load_' . $this->sPageSlug, array( $this, 'Load_Event' ) ) ; add_action( 'do_' . $this->sPageSlug , array( $this, 'Do_Event' ) ) ; return $this ;  } public function Load_Event( $oAdminPage ) { SEUR()->API->Is_Config_Ok() ; $oAdminPage->addSettingSections( $this->sPageSlug , array ( 'section_id'    	=>  $this->sTabSecID ,                       'section_tab_slug'  => 'tabbed_seguimiento_1' , 'title'        		=> __( 'Introduzca un criterio de busqueda', 'seur' ) , 'description'  		=> __( 'Los criterios de búsqueda pueden ser: Un número de seguimiento, una referencia o un rango de fechas.', 'seur' ) . '<br>' . __( 'Tendrá preferencia el Nº de seguimiento sobre referencia y estos sobre fechas.', 'seur' ) ,  ) ) ; $oAdminPage->addSettingFields(	$this->sTabSecID , array ( 'field_id'      => 'expedicion' , 'title'         => __( 'Nº Seguimiento', 'seur' ) , 'type'          => 'number' , 'description'	=> __('Número de seguimiento asignado por SEUR.','seur' ) ) , array ( 'field_id'      => 'referencia' , 'title'         => __( 'Referencia', 'seur' ) , 'type'          => 'text' , 'description'	=>  __('Referencia de envio dada a SEUR desde el comercio.','seur' ) ) , array ( 'field_id'      => 'fechas' , 'title'         => __( 'Fechas desde <-> hasta', 'seur' ) , 'type'          => 'date' , array ( 'type'          => 'date' , ) , 'description'	=> 	__('Entre fechas no se pueden superar 15 días, si solo indica una fecha se buscarán los envíos de esa fecha, si no indica ninguna fecha se buscarán los últimos 15 días.','seur') . '<br>' . __('Se admite cualquier tipo de fecha legible, 1-2-2016, 2016/12/30, 01-10-2016...., ','seur' ) ) , array ( 'field_id'      => 'submit' , 'type'          => 'submit' , 'label'         => __( 'Consultar', 'seur' ) , ) , array ( 'field_id'      => 'result' , 'type'          => 'html' , 'title'         => __( 'Resultado de la consulta', 'seur' ) , 'width' => '100%' ,  ) ) ; add_filter( 'validation_' . $this->sPageSlug, array( $this, 'Validate' ), 10, 3  ) ;  } public function Do_Event ($content) { return  $content ;  } public function Validate( $aInput, $aOldInput, $oFactory) { $_fIsValid = true ; $_aErrors = array() ; $_return_old_inputs = false ; $rev_campos ='' ; $busca = false ; if($aInput['seguimientos']['expedicion'] != '' ) { $out = SEUR()->API->div_class ('Seguimiento por Nº de expedidción:') ; $busca = true ; } else if ($aInput['seguimientos']['referencia'] != '' ) { $out = SEUR()->API->div_class ('Seguimiento por referencia del comercio:') ; $busca = true ; } else { $out = SEUR()->API->div_class ('Seguimiento por periodo entre fechas:') ; if ($aInput['seguimientos']['fechas'][0] != '' || $aInput['seguimientos']['fechas'][1] != '') { if($aInput['seguimientos']['fechas'][1] == '') $aInput['seguimientos']['fechas'][1] = $aInput['seguimientos']['fechas'][0] ; if($aInput['seguimientos']['fechas'][0] == '') $aInput['seguimientos']['fechas'][0] = $aInput['seguimientos']['fechas'][1] ; } else if ($aInput['seguimientos']['fechas'][0] == '' && $aInput['seguimientos']['fechas'][1] == '') { $aInput['seguimientos']['fechas'][0] = date('Y-m-d', strtotime ( '-15 day' 	,strtotime (date('Y-m-d')))) ; $aInput['seguimientos']['fechas'][1] = date('Y-m-d', strtotime (date('Y-m-d'))) ;  } $busca = true ;  } if($busca) { $Fechad = date('d-m-Y', strtotime($aInput['seguimientos']['fechas'][0])) ; $Fechah = date('d-m-Y', strtotime($aInput['seguimientos']['fechas'][1])) ; $out .= '<br>' . SEUR()->SOAP->seguimientos_str ( $aInput['seguimientos']['expedicion'] , $aInput['seguimientos']['referencia'], $Fechad, $Fechah); } $aInput['seguimientos']['result'] = $out ; if ( !$_fIsValid ) { $oFactory->setFieldErrors( $_aErrors ) ; $oFactory->setSettingNotice( SEUR()->API->div_class ( __( 'Se han producido errores en la introducción de datos, por favor, revise los datos introducidos en:', 'seur' ) ) . $rev_campos ,  'SEUR_Error' ) ; if($_return_old_inputs) return $aOldInput ;  } return $aInput ;  }  } new SEUR_seguimientos() ; ?>
